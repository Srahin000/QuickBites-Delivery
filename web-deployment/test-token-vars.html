<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Token Variables - Quickbites</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .token-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .valid { background: #d4edda; color: #155724; }
        .invalid { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Token Variables Test</h1>
    
    <div class="token-info info">
This page tests what different Supabase email template variables return.

Test these email templates:

1. Using {{ .Token }}:
   &lt;a href="{{ .SiteURL }}/reset-password?access_token={{ .Token }}&type=recovery"&gt;Reset Password&lt;/a&gt;

2. Using {{ .TokenHash }}:
   &lt;a href="{{ .SiteURL }}/reset-password?access_token={{ .TokenHash }}&type=recovery"&gt;Reset Password&lt;/a&gt;

3. Using {{ .ConfirmationURL }}:
   &lt;a href="{{ .ConfirmationURL }}"&gt;Reset Password&lt;/a&gt;

The correct one should give you a JWT token that starts with "eyJ" and is very long.
    </div>
    
    <div id="currentToken" class="token-info">Loading...</div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const accessToken = urlParams.get('access_token');
        const type = urlParams.get('type');
        
        let analysis = `Current Token Analysis:
URL: ${window.location.href}

Your Token: "${accessToken || 'MISSING'}"
Type: "${type || 'MISSING'}"

Token Length: ${accessToken ? accessToken.length : 0} characters
Token Format: `;
        
        if (!accessToken) {
            analysis += `❌ NO TOKEN FOUND`;
        } else if (accessToken.startsWith('eyJ')) {
            analysis += `✅ VALID JWT FORMAT (starts with eyJ)`;
        } else if (accessToken.match(/^\d+$/)) {
            analysis += `❌ INVALID - Just numbers (${accessToken})
            
This suggests your Supabase Site URL is wrong or there's a configuration issue.
Expected: JWT token starting with "eyJ"
Got: Just numbers`;
        } else if (accessToken.match(/^[a-f0-9]+$/)) {
            analysis += `❌ INVALID - Hexadecimal hash (${accessToken})
            
This looks like a hash, not a JWT token.
Expected: JWT token starting with "eyJ"
Got: Hexadecimal hash`;
        } else {
            analysis += `❓ UNKNOWN FORMAT`;
        }
        
        if (type !== 'recovery') {
            analysis += `\n\n❌ Type should be "recovery" but got "${type}"`;
        } else {
            analysis += `\n\n✅ Type is correct`;
        }
        
        analysis += `\n\nNext Steps:
1. Check your Supabase Site URL is set to: https://quick-bites-delivery-flax.vercel.app
2. Make sure your email template uses {{ .Token }} (not {{ .TokenHash }})
3. Request a new password reset after fixing the Site URL`;
        
        document.getElementById('currentToken').textContent = analysis;
        document.getElementById('currentToken').className = `token-info ${accessToken && accessToken.startsWith('eyJ') ? 'valid' : 'invalid'}`;
    </script>
</body>
</html>
