<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Access Token - Quickbites</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .token-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .valid { background: #d4edda; color: #155724; }
        .invalid { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Access Token Test</h1>
    
    <div id="tokenInfo" class="token-info">Loading...</div>

    <script>
        function analyzeToken() {
            const urlParams = new URLSearchParams(window.location.search);
            const accessToken = urlParams.get('access_token');
            const type = urlParams.get('type');
            
            let analysis = `URL Analysis:
Current URL: ${window.location.href}

Parameters:
- access_token: ${accessToken || 'Missing'}
- type: ${type || 'Missing'}

Token Analysis:
`;
            
            if (!accessToken) {
                analysis += `❌ No access token found in URL`;
            } else {
                analysis += `Token length: ${accessToken.length} characters
Token starts with: ${accessToken.substring(0, 10)}...
Token ends with: ...${accessToken.substring(accessToken.length - 10)}

`;
                
                if (accessToken.startsWith('eyJ')) {
                    analysis += `✅ Token appears to be a valid JWT format`;
                } else if (accessToken.match(/^\d+$/)) {
                    analysis += `❌ Token is just numbers (${accessToken}) - This is NOT a valid Supabase token!
Expected format: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
This suggests the email template is not using {{ .Token }} correctly.`;
                } else {
                    analysis += `❓ Token format is unclear - may not be valid`;
                }
            }
            
            if (type !== 'recovery') {
                analysis += `\n\n❌ Type parameter is "${type}" but should be "recovery"`;
            } else {
                analysis += `\n\n✅ Type parameter is correct`;
            }
            
            document.getElementById('tokenInfo').textContent = analysis;
            document.getElementById('tokenInfo').className = `token-info ${accessToken && accessToken.startsWith('eyJ') ? 'valid' : 'invalid'}`;
        }
        
        analyzeToken();
    </script>
</body>
</html>
